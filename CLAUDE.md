# CLAUDE.md - Twitter Bulk Blocker

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ã®Claude Codeè¨­å®šã§ã™ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼ˆ~/.claude/CLAUDE.mdï¼‰ã‚’ç¶™æ‰¿ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®åŸºæœ¬æ–¹é‡ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**Twitter Bulk Blocker** - é«˜åº¦ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã¨ãƒãƒƒãƒå‡¦ç†ã‚’å‚™ãˆãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®å¤§è¦æ¨¡Twitterä¸€æ‹¬ãƒ–ãƒ­ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Python 3.x** with requests, pytz, sqlite3
- **Twitter GraphQL API v2 / REST API v1.1**
- **SQLite with WAL mode** (é«˜é€Ÿä¸¦è¡Œå‡¦ç†)
- **3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** (Lookup/Profile/Relationship)

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
twitter_blocker/
â”œâ”€â”€ api.py          # Twitter APIç®¡ç†ï¼ˆGraphQL/RESTï¼‰+ 3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥
â”œâ”€â”€ database.py     # SQLiteç®¡ç† + æ°¸ç¶šçš„å¤±æ•—ã‚­ãƒ£ãƒƒã‚·ãƒ¥ + ãƒãƒƒãƒæœ€é©åŒ–
â”œâ”€â”€ manager.py      # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ + ãƒãƒƒãƒå‡¦ç†åˆ¶å¾¡ + ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”œâ”€â”€ config.py       # è¨­å®šãƒ»ã‚¹ã‚­ãƒ¼ãƒãƒ»Cookieç®¡ç†
â”œâ”€â”€ retry.py        # ãƒªãƒˆãƒ©ã‚¤åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ°¸ç¶šçš„/ä¸€æ™‚çš„å¤±æ•—åˆ†é¡ï¼‰
â””â”€â”€ stats.py        # çµ±è¨ˆè¡¨ç¤ºãƒ»åˆ†æãƒ»è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ
```

## åŸºæœ¬é–‹ç™ºæ–¹é‡

### ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº–
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦æ±‚**: 50ä»¶/ç§’ä»¥ä¸Šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡80%ä»¥ä¸Šç¶­æŒ
- **æ°¸ç¶šçš„å¤±æ•—ã®äº‹å‰ãƒã‚§ãƒƒã‚¯**: suspended/not_found/deactivatedã§APIå‘¼ã³å‡ºã—å›é¿
- **ãƒãƒƒãƒå‡¦ç†å¿…é ˆ**: N+1å•é¡Œã®å¾¹åº•å›é¿
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: SQLiteæ¥ç¶šã¯context managerå¿…é ˆä½¿ç”¨

### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```python
# âœ… æ¨å¥¨: ãƒãƒƒãƒå‡¦ç† + äº‹å‰ãƒã‚§ãƒƒã‚¯
permanent_failures = self.database.get_permanent_failures_batch(batch_ids, user_format)
for user_id in batch_ids:
    if user_id in permanent_failures:
        continue  # APIå‘¼ã³å‡ºã—ã‚¹ã‚­ãƒƒãƒ—

# âŒ é¿ã‘ã‚‹: å€‹åˆ¥å‡¦ç†ã§ã®N+1å•é¡Œ
for user in users:
    if self.database.is_permanent_failure(user):  # å€‹åˆ¥DBå‘¼ã³å‡ºã—
        continue
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **æ°¸ç¶šçš„å¤±æ•—**: suspended, not_found, deactivated (APIå‘¼ã³å‡ºã—ç¦æ­¢)
- **ä¸€æ™‚çš„å¤±æ•—**: unavailable, rate_limit, server_error (ãƒªãƒˆãƒ©ã‚¤å¯¾è±¡)
- **èªè¨¼ã‚¨ãƒ©ãƒ¼**: Cookieå†èª­ã¿è¾¼ã¿ + è‡ªå‹•å¾©æ—§ãƒ•ãƒ­ãƒ¼

## è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æ·±å±¤çŸ¥è­˜ã¯ä»¥ä¸‹ã§å‚ç…§ï¼š

### é–‹ç™ºã‚¬ã‚¤ãƒ‰
- `.claude/guides/api-patterns.md` - Twitter APIæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³è©³ç´°
- `.claude/guides/performance-optimization.md` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–æ‰‹æ³•
- `.claude/guides/error-handling.md` - ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³å®Œå…¨ãƒãƒƒãƒ”ãƒ³ã‚°
- `.claude/guides/caching-strategy.md` - 3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥è©³ç´°

### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- `.claude/patterns/recommended.md` - æ¨å¥¨å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³é›†
- `.claude/patterns/anti-patterns.md` - é¿ã‘ã‚‹ã¹ãã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³
- `.claude/patterns/code-review.md` - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- `.claude/workflows/issue-handling.md` - Issueå¯¾å¿œå®Œå…¨è‡ªå‹•åŒ–ãƒ—ãƒ­ã‚»ã‚¹
- `.claude/workflows/emergency.md` - ç·Šæ€¥äº‹æ…‹å¯¾å¿œãƒ—ãƒ­ãƒˆã‚³ãƒ«

### é‹ç”¨ç®¡ç†
- `.claude/operations/cinnamon-server.md` - æœ¬ç•ªCinnamonã‚µãƒ¼ãƒãƒ¼é‹ç”¨ã‚¬ã‚¤ãƒ‰

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `.claude/troubleshooting/common-issues.md` - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ‰‹é †

### å“è³ªä¿è¨¼
- `.claude/quality/testing-guide.md` - ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ãƒ»ãƒ¢ãƒƒã‚¯å®Ÿè£…ãƒ»CIè¨­å®š

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰
```bash
# é–‹ç™ºç’°å¢ƒ
python3 -m py_compile twitter_blocker/*.py  # å…¨å“è³ªãƒã‚§ãƒƒã‚¯
/check-api-status                          # APIã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
/analyze-performance database              # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
/debug-issue "å•é¡Œã®èª¬æ˜"                    # ç·Šæ€¥ãƒ‡ãƒãƒƒã‚°

# æ‹¡å¼µãƒ˜ãƒƒãƒ€ãƒ¼æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
python3 -m twitter_blocker --test-user "username" --debug --enable-forwarded-for
python3 -m twitter_blocker --all --disable-header-enhancement  # ç·Šæ€¥æ™‚ç„¡åŠ¹åŒ–

# æœ¬ç•ªç’°å¢ƒï¼ˆCinnamonã‚µãƒ¼ãƒãƒ¼ï¼‰
/project:check-cinnamon                    # ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹èª¿æŸ»
/project:restart-service [service_name]    # ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•

# ç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚¹ã‚¤ãƒ¼ãƒˆ v2.0 (Claude Codeæœ€é©åŒ–) 
.claude/cinnamon-monitor-suite.sh [mode]   # çµ±åˆç›£è¦–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (éå¯¾è©±å‹)
.claude/cinnamon-logs-ai-optimized.sh      # AIæœ€é©åŒ–ç‰ˆãƒ»æ§‹é€ åŒ–å‡ºåŠ›
.claude/cinnamon-logs.sh                   # åŸºæœ¬ç‰ˆ (å‚è€ƒç”¨)
```

## ğŸ“Š Cinnamonã‚µãƒ¼ãƒãƒ¼ç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚¹ã‚¤ãƒ¼ãƒˆ

### çµ±åˆç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
```bash
# ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæ¨å¥¨ï¼‰
.claude/cinnamon-monitor-suite.sh
# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§å…¨ãƒ„ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹
```

### å€‹åˆ¥ãƒ„ãƒ¼ãƒ«è©³ç´°
```bash
# ğŸ¤– AIæœ€é©åŒ–ç‰ˆï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
.claude/cinnamon-logs-ai-optimized.sh
# Claude Codeå‘ã‘æ§‹é€ åŒ–å‡ºåŠ›ãƒ»å•é¡Œæ ¹æœ¬åŸå› ç‰¹å®šãƒ»ä¿®æ­£ææ¡ˆ

# ğŸ” åŸºæœ¬ç›£è¦–ï¼ˆå‚è€ƒç”¨ï¼‰
.claude/cinnamon-logs.sh
# å¾“æ¥ç‰ˆãƒ»äººé–“å‘ã‘å‡ºåŠ›

# ğŸ›ï¸ çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
.claude/cinnamon-monitor-suite.sh [mode]
# å¼•æ•°ãƒ™ãƒ¼ã‚¹éå¯¾è©±å‹ãƒ»è¤‡æ•°åˆ†ææ‰‹æ³•ã¸ã®çµ±ä¸€ã‚¢ã‚¯ã‚»ã‚¹
# ä¾‹: .claude/cinnamon-monitor-suite.sh ai
```

### ç›£è¦–ãƒ„ãƒ¼ãƒ«ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰
| çŠ¶æ³ | æ¨å¥¨ãƒ„ãƒ¼ãƒ« | å®Ÿè¡Œæ–¹æ³• |
|------|------------|----------|
| **Claude Codeæ¨™æº–** | AIæœ€é©åŒ–ç‰ˆ | `cinnamon-logs-ai-optimized.sh` |
| **å•é¡Œè©³ç´°èª¿æŸ»** | AIæœ€é©åŒ–ç‰ˆ | `cinnamon-logs-ai-optimized.sh` |
| **åŸºæœ¬ãƒã‚§ãƒƒã‚¯** | çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `cinnamon-monitor-suite.sh basic` |
| **ç·Šæ€¥å¯¾å¿œ** | çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | `cinnamon-monitor-suite.sh emergency` |
| **å‚è€ƒãƒ»æ¯”è¼ƒç”¨** | åŸºæœ¬ç‰ˆ | `cinnamon-logs.sh` |

### Claude Codeåˆ†æã‚·ã‚¹ãƒ†ãƒ 
```bash
# AIæœ€é©åŒ–ç‰ˆã§ã®å•é¡Œç‰¹å®šãƒ»ä¿®æ­£ææ¡ˆ
.claude/cinnamon-logs-ai-optimized.sh

# é‡è¦åº¦åˆ¥åˆ†é¡
# ğŸš¨ CRITICAL: å³åº§ã®ä¿®æ­£ãŒå¿…è¦ï¼ˆKeyErrorç­‰ã®ã‚³ãƒ¼ãƒ‰å•é¡Œï¼‰
# âš ï¸ WARNING: æ³¨æ„ãŒå¿…è¦ï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ï¼‰
# â„¹ï¸ INFO: æƒ…å ±æä¾›ãƒ¬ãƒ™ãƒ«ï¼ˆæœ€é©åŒ–ææ¡ˆï¼‰
# âœ… OK: æ­£å¸¸çŠ¶æ…‹ã®ç¢ºèª
```

### é‡è¦ãªæ•°å€¤
- **GraphQLãƒ¬ãƒ¼ãƒˆåˆ¶é™**: 150ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/15åˆ†
- **RESTãƒ¬ãƒ¼ãƒˆåˆ¶é™**: 300ãƒ–ãƒ­ãƒƒã‚¯/15åˆ†
- **æœ€é©ãƒãƒƒãƒã‚µã‚¤ã‚º**: 50ä»¶
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL**: 30æ—¥
- **ç›®æ¨™å‡¦ç†é€Ÿåº¦**: 50ä»¶/ç§’ä»¥ä¸Š

### ğŸ”§ æ–°æ©Ÿèƒ½: æ‹¡å¼µãƒ˜ãƒƒãƒ€ãƒ¼å¯¾å¿œ (Issue #38)
- **å‹•çš„ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ**: Twitter/Xã‚¢ãƒ³ãƒãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ
- **æ®µéšçš„å°å…¥**: `--disable-header-enhancement`ã€`--enable-forwarded-for`ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- **è©³ç´°**: `.claude/guides/api-patterns.md` å‚ç…§

---

ã“ã®åŸºæœ¬æ–¹é‡ã¨è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ã§é«˜å“è³ªãªtwitter-bulk-blockeré–‹ç™ºã‚’å®Ÿç¾ã—ã¾ã™ã€‚
è©³ç´°ãŒå¿…è¦ãªå ´åˆã¯è©²å½“ã™ã‚‹.claudeãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚